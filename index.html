<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Button</title>
    <style>
        /* CSS cho giao diện đơn giản */
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f2f5;
            margin: 0;
        }

        #downloadBtn {
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            color: white;
            background-color: #007bff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        #downloadBtn:hover {
            background-color: #0056b3;
        }

        /* CSS cho Modal (Pop-up) */
        .modal {
            display: none;
            /* Ẩn mặc định */
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            /* Nền mờ */
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: #ffffff;
            margin: auto;
            padding: 25px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Ẩn/Hiện các phần nội dung */
        .hidden {
            display: none;
        }

        /* CSS cho phần trắc nghiệm */
        .question {
            margin-bottom: 20px;
            display: none;
            /* <-- ẨN TẤT CẢ CÂU HỎI MẶC ĐỊNH */
        }

        .question.active {
            display: block;
            /* <-- CHỈ HIỆN CÂU HỎI CÓ CLASS 'active' */
        }

        .question p {
            font-weight: bold;
            margin-bottom: 10px;
        }

        .question label {
            display: block;
            margin-bottom: 8px;
            cursor: pointer;
        }

        /* CSS cho nút bấm trong modal */
        .modal-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-around;
        }

        .modal-buttons button,
        #submitQuizBtn,
        #nextQuizBtn {
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            border: none;
            cursor: pointer;
        }

        #startQuizBtn {
            background-color: #28a745;
            color: white;
        }

        #cancelBtn {
            background-color: #dc3545;
            color: white;
        }

        #nextQuizBtn {
            background-color: #17a2b8;
            /* Màu khác */
            color: white;
            margin-top: 15px;
        }

        #submitQuizBtn {
            background-color: #007bff;
            color: white;
            margin-top: 15px;
        }

        #answer-feedback {
            margin-top: 10px;
            font-weight: bold;
            text-align: center;
        }

        #answer-feedback.correct {
            color: #28a745;
        }

        #answer-feedback.incorrect {
            color: #dc3545;
        }

        /* CSS cho phần kết quả */
        #result-message {
            font-size: 1.2em;
            font-weight: bold;
            text-align: center;
        }

        #countdown {
            font-size: 1.5em;
            color: #dc3545;
        }

        #reward-links {
            margin-top: 20px;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }

        #reward-links input {
            width: 70%;
            padding: 8px;
            margin-right: 5px;
        }
    </style>
</head>

<body>

    <button id="downloadBtn">DOWNLOAD</button>

    <div id="myModal" class="modal">
        <div class="modal-content">

            <div id="initial-choice">
                <h2>Bạn cần làm trắc nghiệm để lấy link</h2>
                <p>Bạn có muốn tiếp tục không?</p>
                <div class="modal-buttons">
                    <button id="startQuizBtn">Làm trắc nghiệm</button>
                    <button id="cancelBtn">Thôi, bỏ</button>
                </div>
            </div>

            <div id="quiz-container" class="hidden">
                <h2>Trả lời 5 câu hỏi sau:</h2>
                <form id="quizForm">
                    <div class="question">
                        <p>Câu 1: Họ tên đầy đủ của sốp Đạt là gì?</p>
                        <label><input type="radio" name="q1" value="a" data-correct="true"> A. Nguyễn Vũ Đạt</label>
                        <label><input type="radio" name="q1" value="b"> B. Nguyễn Đạt</label>
                        <label><input type="radio" name="q1" value="c"> C. Nguyễn Văn Đạt</label>
                        <label><input type="radio" name="q1" value="d"> D. Lê Văn Đạt</label>
                    </div>
                    <div class="question">
                        <p>Câu 2: Sinh nhật của sốp Đạt là? (dd/mm/yyyy)</p>
                        <label><input type="radio" name="q2" value="a"> A. 09/02/2003</label>
                        <label><input type="radio" name="q2" value="b"> B. 09/03/2002</label>
                        <label><input type="radio" name="q2" value="c" data-correct="true"> C. 02/09/2003</label>
                        <label><input type="radio" name="q2" value="d"> D. 03/02/2009</label>
                    </div>
                    <div class="question">
                        <p>Câu 3: Nhóm 8386 ai là người cầm key?</p>
                        <label><input type="radio" name="q3" value="a" data-correct="true"> A. Lê Thái Thịnh</label>
                        <label><input type="radio" name="q3" value="b"> B. Lê Quốc Thắng</label>
                        <label><input type="radio" name="q3" value="c"> C. Sốp Đạt</label>
                        <label><input type="radio" name="q3" value="d"> D. Phạm Hoàng Lộc</label>
                    </div>
                    <div class="question">
                        <p>Câu 4: Trong 3 chiếc xe sau chiếc nào có giá trị cao nhất:</p>
                        <label><input type="radio" name="q4" value="a" data-correct="true"> A. Mercedes-Benz C
                            300</label>
                        <label><input type="radio" name="q4" value="b"> B. Honda Dream</label>
                        <label><input type="radio" name="q4" value="c"> C. Honda Cub</label>
                        <label><input type="radio" name="q4" value="d"> D. Xe đạp cao cấp</label>
                    </div>
                    <div class="question">
                        <p>Câu 5: Bạn sẽ cố gắng học tập chứ:</p>
                        <label><input type="radio" name="q5" value="a" data-correct="true"> A. Có, tôi sẽ cố
                            gắng</label>
                        <label><input type="radio" name="q5" value="b"> B. Thôi lười học làm gì</label>
                    </div>

                    <p id="answer-feedback" class="hidden"></p>
                    <button type="button" id="nextQuizBtn" class="hidden">Câu tiếp theo</button>
                    <button type="submit" id="submitQuizBtn" class="hidden">Hoàn thành</button>
                </form>
            </div>

            <div id="result-container" class="hidden">
                <p id="result-message"></p>
                <div id="countdown-timer" class="hidden" style="text-align: center;">
                    <p>Chuẩn bị nhận link sau: <span id="countdown">5</span>s</p>
                </div>
                <div id="reward-links" class="hidden">
                    <h3>Phần thưởng của bạn:</h3>

                    <p><strong>1. Tải file ZIP:</strong></p>
                    <a href="https://github.com/vdat293/baptap10pttkw/archive/refs/heads/main.zip" target="_blank">
                        https://github.com/vdat293/baptap10pttkw
                    </a>

                    <p style="margin-top: 15px;"><strong>2. Dành cho người có GitHub (Copy link clone):</strong></p>
                    <input type="text" value="git clone https://github.com/vdat293/baptap10pttkw" id="git-link"
                        readonly>
                    <button id="copyBtn">Copy</button>
                </div>
            </div>

        </div>
    </div>

    <script>
        // Lấy các element cần thiết
        const modal = document.getElementById('myModal');
        const downloadBtn = document.getElementById('downloadBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const startQuizBtn = document.getElementById('startQuizBtn');

        const initialChoiceDiv = document.getElementById('initial-choice');
        const quizContainerDiv = document.getElementById('quiz-container');
        const resultContainerDiv = document.getElementById('result-container');

        const quizForm = document.getElementById('quizForm');
        const questions = document.querySelectorAll('#quiz-container .question');
        const nextQuizBtn = document.getElementById('nextQuizBtn');
        const submitQuizBtn = document.getElementById('submitQuizBtn');

        const resultMessage = document.getElementById('result-message');
        const countdownTimer = document.getElementById('countdown-timer');
        const countdownSpan = document.getElementById('countdown');
        const rewardLinksDiv = document.getElementById('reward-links');
        const copyBtn = document.getElementById('copyBtn');
        const gitLinkInput = document.getElementById('git-link');
        const answerFeedback = document.getElementById('answer-feedback');

        const QUIZ_STATE_KEY = 'quizResultState';
        const QUIZ_STATUS_SUCCESS = 'success';
        const QUIZ_STATUS_BAD = 'bad';

        let currentQuestionIndex = 0;
        let countdownInterval = null;

        // Mở Modal khi nhấn nút Download
        downloadBtn.onclick = function () {
            modal.style.display = 'flex';
            const savedState = getSavedQuizState();

            if (savedState === QUIZ_STATUS_SUCCESS) {
                showSuccessResult(true);
            } else if (savedState === QUIZ_STATUS_BAD) {
                showPermanentFailureMessage();
            } else {
                showInitialChoice();
            }
        };

        // Đóng Modal khi nhấn "Thôi, bỏ"
        cancelBtn.onclick = function () {
            closeModal();
        };

        // Bắt đầu làm trắc nghiệm
        startQuizBtn.onclick = function () {
            if (getSavedQuizState() === QUIZ_STATUS_BAD) {
                showPermanentFailureMessage();
                return;
            }
            startQuiz();
        };

        // Xử lý nút "Câu tiếp theo"
        nextQuizBtn.onclick = function () {
            const currentQuestion = questions[currentQuestionIndex];
            const selectedAnswer = currentQuestion.querySelector('input[type="radio"]:checked');

            if (!selectedAnswer) {
                alert("Bạn phải chọn một đáp án!");
                return;
            }

            const questionNumber = currentQuestionIndex + 1;
            const correctInput = currentQuestion.querySelector('input[data-correct="true"]');

            answerFeedback.classList.remove('correct', 'incorrect');

            if (correctInput) {
                const correctLabel = correctInput.closest('label');
                const correctText = correctLabel ? correctLabel.textContent.trim() : 'đáp án đúng';

                if (selectedAnswer === correctInput) {
                    answerFeedback.textContent = `Câu ${questionNumber}: Chính xác!`;
                    answerFeedback.classList.add('correct');
                } else {
                    answerFeedback.textContent = `Câu ${questionNumber}: Sai rồi. Đáp án đúng là ${correctText}.`;
                    answerFeedback.classList.add('incorrect');
                }
            } else {
                answerFeedback.textContent = `Câu ${questionNumber}: Đáp án đã được ghi nhận.`;
            }

            answerFeedback.classList.remove('hidden');

            currentQuestion.classList.remove('active');
            currentQuestionIndex++;

            if (currentQuestionIndex < questions.length) {
                showQuestion(currentQuestionIndex);
            }

            if (currentQuestionIndex === questions.length - 1) {
                nextQuizBtn.classList.add('hidden');
                submitQuizBtn.classList.remove('hidden');
            }
        };

        // Xử lý khi nộp form (Nút "Hoàn thành")
        quizForm.onsubmit = function (event) {
            event.preventDefault();

            const q5Answer = document.querySelector('input[name="q5"]:checked');

            if (!q5Answer) {
                alert("Bạn phải trả lời câu 5!");
                return;
            }

            nextQuizBtn.classList.add('hidden');
            submitQuizBtn.classList.add('hidden');

            if (q5Answer.value === 'a') {
                setQuizState(QUIZ_STATUS_SUCCESS);
                showSuccessResult(false);
            } else {
                setQuizState(QUIZ_STATUS_BAD);
                showPermanentFailureMessage();
            }
        };

        // Hàm đếm ngược
        function startCountdown() {
            let seconds = 5;
            countdownSpan.textContent = seconds;

            countdownInterval = setInterval(() => {
                seconds--;
                countdownSpan.textContent = seconds;

                if (seconds <= 0) {
                    clearCountdown();
                    countdownTimer.classList.add('hidden');
                    rewardLinksDiv.classList.remove('hidden');
                }
            }, 1000);
        }

        // Xử lý nút copy
        copyBtn.onclick = function () {
            gitLinkInput.select();

            navigator.clipboard.writeText(gitLinkInput.value).then(() => {
                copyBtn.textContent = 'Đã Copy!';
                setTimeout(() => {
                    copyBtn.textContent = 'Copy';
                }, 2000);
            }).catch(err => {
                console.error('Không thể copy: ', err);
                try {
                    document.execCommand('copy');
                    copyBtn.textContent = 'Đã Copy!';
                    setTimeout(() => {
                        copyBtn.textContent = 'Copy';
                    }, 2000);
                } catch (e) {
                    alert('Không thể tự động copy, vui lòng copy thủ công.');
                }
            });
        };

        // Đóng modal khi nhấn ra ngoài
        window.onclick = function (event) {
            if (event.target === modal) {
                closeModal();
            }
        };

        function startQuiz() {
            resetQuizFormState();
            initialChoiceDiv.classList.add('hidden');
            resultContainerDiv.classList.add('hidden');
            rewardLinksDiv.classList.add('hidden');
            countdownTimer.classList.add('hidden');
            quizContainerDiv.classList.remove('hidden');

            showQuestion(0);
            nextQuizBtn.classList.remove('hidden');
            submitQuizBtn.classList.add('hidden');
        }

        function showQuestion(index) {
            questions.forEach((question, idx) => {
                question.classList.toggle('active', idx === index);
            });
        }

        function resetQuizFormState() {
            quizForm.reset();
            questions.forEach(question => question.classList.remove('active'));
            currentQuestionIndex = 0;
            answerFeedback.textContent = '';
            answerFeedback.classList.add('hidden');
            answerFeedback.classList.remove('correct', 'incorrect');
        }

        function showInitialChoice() {
            clearCountdown();
            resetQuizFormState();
            initialChoiceDiv.classList.remove('hidden');
            quizContainerDiv.classList.add('hidden');
            resultContainerDiv.classList.add('hidden');
            rewardLinksDiv.classList.add('hidden');
            countdownTimer.classList.add('hidden');
            nextQuizBtn.classList.add('hidden');
            submitQuizBtn.classList.add('hidden');
            resultMessage.textContent = '';
            resultMessage.style.color = '';
        }

        function showSuccessResult(skipCountdown) {
            clearCountdown();
            initialChoiceDiv.classList.add('hidden');
            quizContainerDiv.classList.add('hidden');
            resultContainerDiv.classList.remove('hidden');
            nextQuizBtn.classList.add('hidden');
            submitQuizBtn.classList.add('hidden');

            resultMessage.style.color = 'green';
            resultMessage.textContent = skipCountdown
                ? "Bạn đã hoàn thành trắc nghiệm trước đó. Đây là link tải dành cho bạn."
                : "Tuyệt vời! Chúc bạn học tốt!";

            if (skipCountdown) {
                countdownTimer.classList.add('hidden');
                rewardLinksDiv.classList.remove('hidden');
            } else {
                rewardLinksDiv.classList.add('hidden');
                countdownTimer.classList.remove('hidden');
                startCountdown();
            }
        }

        function showPermanentFailureMessage() {
            clearCountdown();
            initialChoiceDiv.classList.add('hidden');
            quizContainerDiv.classList.add('hidden');
            resultContainerDiv.classList.remove('hidden');
            nextQuizBtn.classList.add('hidden');
            submitQuizBtn.classList.add('hidden');

            resultMessage.style.color = 'red';
            resultMessage.textContent = "Không cố gắng thì lấy bài làm gì, đối phó à!!!!!";
            countdownTimer.classList.add('hidden');
            rewardLinksDiv.classList.add('hidden');
        }

        function getSavedQuizState() {
            return localStorage.getItem(QUIZ_STATE_KEY);
        }

        function setQuizState(state) {
            localStorage.setItem(QUIZ_STATE_KEY, state);
        }

        function clearCountdown() {
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
        }

        function closeModal() {
            modal.style.display = 'none';
            clearCountdown();
            resetQuizFormState();
            rewardLinksDiv.classList.add('hidden');
            countdownTimer.classList.add('hidden');
            resultMessage.textContent = '';
            resultMessage.style.color = '';
            nextQuizBtn.classList.add('hidden');
            submitQuizBtn.classList.add('hidden');
            initialChoiceDiv.classList.add('hidden');
            quizContainerDiv.classList.add('hidden');
            resultContainerDiv.classList.add('hidden');
        }

    </script>

</body>

</html>